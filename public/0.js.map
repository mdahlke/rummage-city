{"version":3,"sources":["webpack:///resources/js/components/Map/ListingsMap.vue","webpack:///./resources/js/components/Map/ListingsMap.vue?1470","webpack:///./resources/js/components/Map/ListingsMap.vue","webpack:///./resources/js/components/Map/ListingsMap.vue?157f","webpack:///./resources/js/components/Map/ListingsMap.vue?52bf"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAKA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,qBADA;AAEA,MAFA,kBAEA;AACA;AACA,aADA;AAEA,kBAFA;AAGA,mBAHA;AAIA,qBAJA;AAKA,gBALA;AAMA,qBANA;AAOA;AAPA;AASA,GAZA;AAaA;AACA,mBADA;AAEA;AACA,kBADA;AAEA;AAFA,KAFA;AAMA;AACA,kBADA;AAEA;AAFA,KANA;AAUA;AACA,kBADA;AAEA;AAFA,KAVA;AAcA;AACA,kBADA;AAEA;AAFA,KAdA;AAkBA;AACA,kBADA;AAEA;AAFA,KAlBA;AAsBA;AACA,kBADA;AAEA;AAFA,KAtBA;AA0BA;AACA,kBADA;AAEA;AAFA,KA1BA;AA8BA;AACA,kBADA;AAEA;AAFA;AA9BA,GAbA;AAgDA,SAhDA,qBAgDA;AACA;AACA,0BADA;AAEA;AAFA;;AAIA;AACA;AACA;AAEA,GAzDA;AA0DA,SA1DA,qBA0DA;AAAA;;AACA;AACA;AACA;;AAEA;AACA;AACA,gCADA;AAEA,iDAFA;AAGA;AAAA;AAAA;AAAA,OAHA;AAIA;AAJA,OANA,CAaA;;AACA;AAEA;;;;;;;AAMA;AACA;;AAEA;AACA;AACA;AAEA;AACA;;AACA;AACA;;AACA;AACA,4BADA,CAEA;AACA;;AACA;;AAEA;AACA;;AAEA;;AACA;AACA;AACA;AACA;AACA,OAtBA;AAuBA,KA1BA;AA4BA;AACA;;AACA;AACA;;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GA1HA;AA2HA;AACA,cADA,wBACA;AAAA;AAAA;;AACA;AACA;AACA;;AAEA,yCACA,SADA,CACA;AAAA;AAAA;AAAA,OADA,EAEA,KAFA,CAEA,QAFA;;AAIA;AACA;AACA;;AAEA;AACA,KAfA;AAgBA,aAhBA,qBAgBA,OAhBA,EAgBA;AACA,kBACA;AAAA;AAAA,SACA,SADA,CACA,uEADA,EAEA,OAFA,CAEA,gCAFA,EAGA,WAHA,CAGA,OAHA,EAIA,KAJA,CAIA,QAJA,CADA;AAMA,KAvBA;AAwBA,gBAxBA,wBAwBA,OAxBA,EAwBA;AACA;AAAA;AAAA,SACA,OADA,CACA,gCADA,EAEA,WAFA,CAEA,OAFA;AAGA,KA5BA;AA6BA,0BA7BA,kCA6BA,MA7BA,EA6BA;AACA;AACA,sBADA;AAEA;AAFA;AAKA;AACA,uBADA;AAEA,mBAFA;AAGA;AACA,sGAEA,KAFA;AADA;AAHA;AA8BA,KAjEA;AAkEA,QAlEA,gBAkEA,OAlEA,EAkEA;AACA;;AACA;AACA;AACA;AACA;AACA,SAHA;AAIA;AACA,KA1EA;AA2EA,gBA3EA,wBA2EA,OA3EA,EA2EA;AACA;;AACA;AACA;AACA;AACA;AACA,SAHA;AAIA;AACA;AAnFA;AA3HA,G;;;;;;;;;;;;ACZA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,oBAAoB,SAAS,sBAAsB,EAAE;AACrD;AACA;AACA;;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAA0F;AAC3B;AACL;;;AAG1D;AACgG;AAChG,gBAAgB,2GAAU;AAC1B,EAAE,iFAAM;AACR,EAAE,sFAAM;AACR,EAAE,+FAAe;AACjB;AACA;AACA;AACA;;AAEA;;AAEA;AACA,IAAI,KAAU,EAAE,YAiBf;AACD;AACe,gF;;;;;;;;;;;;ACtCf;AAAA;AAAA,wCAAiM,CAAgB,uPAAG,EAAC,C;;;;;;;;;;;;ACArN;AAAA;AAAA;AAAA;AAAA;AAAA","file":"0.js","sourcesContent":["<template>\n    <div id=\"listings__map\"></div>\n</template>\n\n<script>\n    import MapboxPopup from './MapboxPopup.vue';\n    import {mapbox_latlng} from '../../helpers';\n    import '../../../sass/component/listings-map.scss';\n    import '../../../../node_modules/mapbox-gl/dist/mapbox-gl.css';\n\n    const mapboxgl = require('mapbox-gl');\n\n    export default {\n        name: 'ListingsMap',\n        data() {\n            return {\n                map: {},\n                platform: {},\n                mapEvents: {},\n                data_points: [],\n                icon: null,\n                listing_ids: [],\n                visible_listings: []\n            };\n        },\n        props: {\n            listings: Array,\n            appId: {\n                type: String,\n                default: 'lQPofquBtIF1aAOEarx7'\n            },\n            appCode: {\n                type: String,\n                default: '28icBNVvG484yi09NA2c1g'\n            },\n            lat: {\n                type: String,\n                default: '43.75171'\n            },\n            lng: {\n                type: String,\n                default: '-88.44867'\n            },\n            zoom: {\n                type: Number,\n                default: 10\n            },\n            width: {\n                type: String,\n                default: '100%'\n            },\n            height: {\n                type: String,\n                default: 'calc(100vh - 50px)'\n            },\n            svg: {\n                type: String,\n                default: null\n            }\n        },\n        created() {\n            this.platform = new H.service.Platform({\n                'app_id': this.appId,\n                'apikey': '7W5ZSgnP_hvci-01R4EbN1_T17e_5x1zVr54MheJxTk'\n            });\n            if (this.svg) {\n                this.icon = new H.map.Icon(this.svg);\n            }\n\n        },\n        mounted() {\n            if (this.listings) {\n                this.visible_listings = this.listings;\n            }\n\n            mapboxgl.accessToken = 'pk.eyJ1IjoibWRhaGxrZSIsImEiOiJjazI2bGgzNjUwZzlsM2dxaDd2OXgxZW9yIn0.kKYT-PvLDgQeFZWc2MMOAw';\n            this.map = new mapboxgl.Map({\n                container: 'listings__map',\n                style: 'mapbox://styles/mapbox/streets-v11',\n                center: {lng: this.lng, lat: this.lat},\n                zoom: this.zoom\n            });\n\n            // Add zoom and rotation controls to the map.\n            this.map.addControl(new mapboxgl.NavigationControl());\n\n            /**\n             * When the user stops dragging the map we need to get the coordinates\n             * to retrieve any new listings that should be visible on the screen\n             *\n             * @TODO break out the inner logic to allow for zoom in/out\n             */\n            this.map.on('dragend', () => {\n                let bounds = this.map.getBounds();\n\n                this.get_listings_in_bounds(bounds).then((results) => {\n                    const listings = results.data.data.listings.data;\n                    this.visible_listings = listings;\n\n                    let r;\n                    let popup;\n                    for (let i in listings) {\n                        popup = null;\n                        if (listings.hasOwnProperty(i)) {\n                            r = listings[i];\n                            // laravel is sending this value back as a string\n                            // we need to change it to a boolean\n                            r.isSaved = (r.isSaved.toLowerCase() === 'true');\n\n                            if (!this.listing_ids.includes(r.id)) {\n                                this.listing_ids.push(r.id);\n\n                                popup = this.create_popup(r);\n                                this.add_marker(mapbox_latlng(r), popup);\n                            }\n                        }\n                    }\n                });\n            });\n\n            let l;\n            let popup;\n            for (let i in this.listings) {\n                popup = null;\n                if (this.listings.hasOwnProperty(i)) {\n                    l = this.listings[i];\n\n                    if (l.id) {\n                        this.listing_ids.push(l.id);\n                        popup = this.create_popup(l);\n                        this.add_marker(mapbox_latlng(l), popup);\n                    }\n                }\n            }\n        },\n        methods: {\n            add_marker(coords = null, popup = null) {\n                if (!coords.lat || !coords.lng) {\n                    return false;\n                }\n\n                let marker = new mapboxgl.Marker()\n                    .setLngLat({lon: coords.lng, lat: coords.lat})\n                    .addTo(this.map);\n\n                if (popup) {\n                    marker.setPopup(popup);\n                }\n\n                return marker;\n            },\n            add_popup(listing) {\n                const popup =\n                    new mapboxgl.Popup({className: 'listing__popup'})\n                        .setLngLat(mapbox_latlng(listing))\n                        .setHTML(\"<h1>\" + listing.title + \"</h1>\")\n                        .setMaxWidth(\"300px\")\n                        .addTo(this.map);\n            },\n            create_popup(listing) {\n                return new mapboxgl.Popup({className: 'listing__popup'})\n                    .setHTML(\"<h1>\" + listing.title + \"</h1>\")\n                    .setMaxWidth(\"300px\");\n            },\n            get_listings_in_bounds(bounds) {\n                const query = JSON.stringify(JSON.stringify({\n                    sw: bounds._sw,\n                    ne: bounds._ne\n                }));\n\n                return axios({\n                    url: '/graphql',\n                    type: 'get',\n                    params: {\n                        query: `\n\t\t\t\t\t\t\tquery FetchListingsInBounds {\n\t\t\t\t\t\t\t  listings(bounds: ` + query + `) {\n\t\t\t\t\t\t\t    data {\n\t\t\t\t\t\t\t      id\n\t\t\t\t\t\t\t      title\n\t\t\t\t\t\t\t      address\n\t\t\t\t\t\t\t      latitude\n\t\t\t\t\t\t\t      longitude\n\t\t\t\t\t\t\t      isSaved\n\t\t\t\t\t\t\t      saveUrl\n\t\t\t\t\t\t\t      removeSavedUrl\n\t\t\t\t\t\t\t      date {\n\t\t\t\t\t\t\t        start\n\t\t\t\t\t\t\t        end\n\t\t\t\t\t\t\t      }\n\t\t\t\t\t\t\t      image {\n\t\t\t\t\t\t\t        name\n\t\t\t\t\t\t\t        path\n\t\t\t\t\t\t\t      }\n\t\t\t\t\t\t\t    }\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t`\n                    }\n                });\n            },\n            save(listing) {\n                console.log('save', listing.isSaved);\n                if (!listing.isSaved) {\n                    axios.post(listing.saveUrl).then(function (e) {\n                        console.log(e);\n                        listing.isSaved = true;\n                    });\n                }\n            },\n            remove_saved(listing) {\n                console.log('remove', listing.isSaved);\n                if (listing.isSaved) {\n                    axios.post(listing.removeSavedUrl).then((e) => {\n                        listing.isSaved = false;\n                        console.log(listing);\n                    });\n                }\n            }\n        }\n    };\n\n</script>\n","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\"div\", { attrs: { id: \"listings__map\" } })\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","import { render, staticRenderFns } from \"./ListingsMap.vue?vue&type=template&id=52f93b7f&\"\nimport script from \"./ListingsMap.vue?vue&type=script&lang=js&\"\nexport * from \"./ListingsMap.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/Users/mdahlke/Sites/websites/rummagecity.dev/www/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('52f93b7f')) {\n      api.createRecord('52f93b7f', component.options)\n    } else {\n      api.reload('52f93b7f', component.options)\n    }\n    module.hot.accept(\"./ListingsMap.vue?vue&type=template&id=52f93b7f&\", function () {\n      api.rerender('52f93b7f', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"resources/js/components/Map/ListingsMap.vue\"\nexport default component.exports","import mod from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--4-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ListingsMap.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/babel-loader/lib/index.js??ref--4-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ListingsMap.vue?vue&type=script&lang=js&\"","export * from \"-!../../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ListingsMap.vue?vue&type=template&id=52f93b7f&\""],"sourceRoot":""}